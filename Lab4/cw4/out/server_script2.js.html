<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server_script2.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server_script2.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Moduły wbudowane Node.js:
 * - http: tworzenie serwera
 * - fs: operacje na plikach
 * - url: parsowanie adresów URL
 * - querystring: parsowanie danych z formularzy
 */
const http = require('http');
const fs = require('fs');
const { URL } = require('url');
const querystring = require('querystring');

const PORT = 8000;
const FILE_PATH = __dirname + '/entries.txt';

/**
 * Generuje pełną stronę HTML na podstawie wpisów.
 * @param {string} entriesHtml - HTML zawierający wszystkie wpisy.
 * @returns {string} - Gotowy dokument HTML jako tekst.
 * @author Jakub Zając &lt;jakubtomaszkrzysztof@gmail.com>
 */
function renderPage(entriesHtml) {
    return `
        &lt;!DOCTYPE html>
        &lt;html lang="pl">
        &lt;head>
            &lt;meta charset="UTF-8">
            &lt;title>Księga Gości&lt;/title>
        &lt;/head>
        &lt;body>
            &lt;h1>Księga Gości&lt;/h1>
            &lt;h2>Poprzednie wpisy&lt;/h2>
            &lt;div>${entriesHtml}&lt;/div>
            &lt;hr>
            &lt;h2>Nowy wpis&lt;/h2>
            &lt;form method="POST" action="/">
                &lt;label>Imię i nazwisko:&lt;br>
                    &lt;input type="text" name="name" required>
                &lt;/label>&lt;br>&lt;br>
                &lt;label>Treść wpisu:&lt;br>
                    &lt;textarea name="message" rows="4" cols="50" required>&lt;/textarea>
                &lt;/label>&lt;br>&lt;br>
                &lt;input type="submit" value="Dodaj wpis">
            &lt;/form>
        &lt;/body>
        &lt;/html>`;
}

/**
 * Tworzy serwer HTTP, który obsługuje wyświetlanie oraz zapisywanie wpisów do księgi gości.
 * @param {http.IncomingMessage} req - Żądanie HTTP.
 * @param {http.ServerResponse} res - Odpowiedź HTTP.
 */
const server = http.createServer((req, res) => {
    const url = new URL(req.url, `http://${req.headers.host}`);

    if(req.method === 'GET' &amp;&amp; url.pathname === '/') {
        fs.readFile(FILE_PATH, 'utf-8', (err, data) => {
            const entriesHtml = err || !data || !data.trim()
                ? '&lt;p>Brak wpisów.&lt;/p>'
                : data.split('\n').map(entry => `&lt;p>${entry}&lt;/p>`).join('');
            res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
            res.end(renderPage(entriesHtml));
        });
    }
    else if(req.method === 'POST' &amp;&amp; url.pathname === '/') {
        let body = '';
        req.on('data', chunk => body += chunk.toString());
        req.on('end', () => {
            const { name, message } = querystring.parse(body);
            const entry = `${new Date().toLocaleString()} - ${name}: ${message.replace(/\r?\n/g, ' ')}`;
            fs.appendFile(FILE_PATH, entry + '\n', err => {
                if (err) {
                    res.writeHead(500, { 'Content-Type': 'text/plain' });
                    return res.end('Błąd zapisu danych');
                }
                res.writeHead(302, { Location: '/' });
                res.end();
            });
        });
    }
    else {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('Nie znaleziono strony.');
    }
});

/**
 * Uruchomienie serwera i nasłuchiwanie na porcie 8000.
 */
server.listen(PORT, () => {
    console.log(`Serwer działa na http://localhost:${PORT}/`);
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#http">http</a></li><li><a href="global.html#renderPage">renderPage</a></li><li><a href="global.html#requestListener">requestListener</a></li><li><a href="global.html#server">server</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue May 13 2025 12:45:09 GMT+0200 (czas środkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
